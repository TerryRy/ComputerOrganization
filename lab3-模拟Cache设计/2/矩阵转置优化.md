# 矩阵转置优化

> 分值：10
>
> 难度：5

在本节中，我们将给出特定大小的矩阵，请同学们应用分块等优化思想，利用我们在实验一中实现的Cache模拟器，检验不同的分块策略对Cache命中/缺失情况的影响，并通过逐步优化使得miss（即缺失数）尽可能低。**本实验只需要补全`trans.c`中的内容，提交评测也只需提交该文件。**

## 题目描述

给定Cache结构为：s=4,E=1,b=5 。

考察trans.c中的矩阵转置函数`transpose_submit`，该函数要实现矩阵转置的功能，将N行M列矩阵A转置为M行N列的矩阵B。本节实验包含两个题目，我们分别给出矩阵的M和N，并要求根据Cache的结构和矩阵的结构，计算出一个比较好的矩阵转置方案，使得miss数量达到要求。

在完成转置功能以外，代码还需满足以下要求：

- 转置函数使用局部变量类型只能为`int`，且限制局部变量个数不超过12个（建议将局部变量声明写在函数初始位置，参看代码注释）。
- 如果在`transpose_submit`之外自己定义了其他的辅助函数，那么需要保证所有函数的局部变量个数之和不得超过12个。
- 不得在函数中使用数组或者尝试用malloc申请内存。
- 不得修改矩阵A中的值，矩阵B中的值可以随意修改，只需满足最终的检验正确性。
- 转置函数或其他辅助函数一律不得使用递归。

以上的代码要求会在评测后进行统一检查，**如不满足以上要求则视为未通过本实验**。

本节的评测逻辑较为复杂，我们将根据实现的矩阵转置函数`transpose_submit`，模拟生成该函数执行过程中对应的memory trace，并通过参考Cache程序`csim-ref`来模拟内存访问的情况，最终通过Cache得出miss数量，**miss数量达到要求即可通过本节实验**。

具体分值设置如下：

### 题目一：16 x 16 矩阵转置优化（5分）

| 等级         | miss情况       | 得分  | 预期判定结果 |
| ------------ | -------------- | ----- | ------------ |
| 正确验证     | 转置结果无误   | 1     | Wrong Answer |
| 基础要求     | miss < 200     | 3     | Wrong Answer |
| **通过要求** | **miss < 100** | **5** | **Accepted** |
| 优秀挑战     | miss < 75      | 5     | Excellent    |

### 题目二：32 x 32 矩阵转置优化（5分）

| 等级         | miss情况       | 得分  | 预期判定结果 |
| ------------ | -------------- | ----- | ------------ |
| 正确验证     | 转置结果无误   | 1     | Wrong Answer |
| 基础要求     | miss < 600     | 3     | Wrong Answer |
| **通过要求** | **miss < 400** | **5** | **Accepted** |
| 优秀挑战     | miss < 300     | 5     | Excellent    |

## 输入输出样例

输入命令

```bash
./test-trans -M 16 -N 16
```

输出结果

```txt
Function 0 (1 total)
Step 1: Validating and generating memory traces
Step 2: Evaluating performance (s=4, E=1, b=5)
...

Summary for official submission (func 0): correctness=1 misses=67

TEST_TRANS_RESULTS=1:67
```

得到`TEST_TRANS_RESULTS=1:67`，即miss为67，达到通过要求。